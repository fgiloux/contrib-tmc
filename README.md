# TMC - Transparent Multi-Cluster

Experimental multi-cluster workload management platform for Kubernetes, built on top of [kcp](https://github.com/kcp-dev/kcp)

## What is TMC?

TMC is a multi-cluster management platform that allows you to manage multiple Kubernetes clusters from a single control plane. TMC is to be layered on top of KCP and extends its functionality to multi-cluster workload management.

## Quick start

### Build binaries

```shell
$ make build
```

### Copy CLI binaries to PATH

```shell
# Either copy the binaries to a directory in your PATH
$ cp bin/{kubectl-tmc,kubectl-workloads} /usr/local/bin/kubectl-tmc

# Or add the bin directory to your PATH
$ export PATH=$PATH:$(pwd)/bin
```

### Install TMC on top of kcp

> [!IMPORTANT]  
> Elevated privileges are needed for TMC installation. Run the make command with the kcp-admin user or equivalent.

```shell
$ make install
```

### Run TMC binary locally

> [!IMPORTANT]  
> The kubeconfig needs to be configured with a context having elevated privileges, kcp-admin user or equivalent and pointing to the tmc workspace, i.e. "root:tmc".
> This context can be passed as a parameter to the start command.
> In addition a "base" context needs to be configured pointing to kcp base with the shard admin user or equivalent.

```shell
$ ./bin/tmc start --context tmc
```

### Use

Create a workspace for your SyncTarget

```shell
$ kubectl tmc workspace create tmc-ws --type tmc --enter
```

Create a SyncTarget for the target cluster
 
```shell
$  kubectl tmc workload sync cluster-1 --syncer-image ghcr.io/kcp-dev/contrib-tmc/syncer:latest --output-file cluster-1.yaml
```

Login into the target cluster and apply the manifests generated by TMC

```shell
$ KUBECONFIG=<pcluster-config> kubectl apply -f "cluster-1.yaml"
```

Bind the compute resources from any workspace where you want to deploy on the targeted cluster

```shell
$ kubectl tmc bind compute root:tmc-ws
```

Create some workload in the kcp workspace

```shell
$ kubectl create deployment kuard --image gcr.io/kuar-demo/kuard-amd64:blue
```

## Known issues

- [ ] The syncer needs to connect to the TMC API server, which is now separated from kcp (different endpoint)
- [ ] TMC currently does not support sharding
- [ ] Log tunneling needs to be brought back

## Background

Historically TMC was part of kcp. It has now been spinned off as a separate project, whose capabilities can be layered on top of kcp. This leaves kcp more slim for use cases not needing TMC.

https://github.com/kcp-dev/kcp/issues/2954

